

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>P3DFFT++ Fortran Reference &#8212; P3DFFT++ 3.0.0 documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="P3DFFT++ C++ examples" href="p3dfft++_c++_examples.html" />
    <link rel="prev" title="P3DFFT++ C Reference" href="p3dfft++_c_reference.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="p3dfft++_c++_examples.html" title="P3DFFT++ C++ examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="p3dfft++_c_reference.html" title="P3DFFT++ C Reference"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">P3DFFT++ 3.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="p3dfft++_documentation.html" accesskey="U">P3DFFT++ Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="p3dfft++_c_reference.html"
                        title="previous chapter">P3DFFT++ C Reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="p3dfft++_c++_examples.html"
                        title="next chapter">P3DFFT++ C++ examples</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="p3dfft-fortran-reference">
<h1><a class="toc-backref" href="#id3">P3DFFT++ Fortran Reference</a><a class="headerlink" href="#p3dfft-fortran-reference" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#p3dfft-fortran-reference" id="id3">P3DFFT++ Fortran Reference</a><ul>
<li><a class="reference internal" href="#setup-and-grid-layout" id="id4">Setup and Grid Layout</a><ul>
<li><a class="reference internal" href="#p3dfft-setup" id="id5">p3dfft_setup</a></li>
<li><a class="reference internal" href="#p3dfft-cleanup" id="id6">p3dfft_cleanup</a></li>
<li><a class="reference internal" href="#p3dfft-init-grid" id="id7">p3dfft_init_grid</a></li>
<li><a class="reference internal" href="#p3dfft-free-grid-f" id="id8">p3dfft_free_grid_f</a></li>
</ul>
</li>
<li><a class="reference internal" href="#one-dimensional-1d-transforms" id="id9">One-dimensional (1D) Transforms</a><ul>
<li><a class="reference internal" href="#d-transform-planning" id="id10">1D transform planning</a></li>
<li><a class="reference internal" href="#d-transform-execution" id="id11">1D transform execution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#three-dimensional-transforms" id="id12">Three-dimensional transforms</a><ul>
<li><a class="reference internal" href="#id1" id="id13">3D transform planning</a></li>
<li><a class="reference internal" href="#id2" id="id14">3D transform execution</a></li>
<li><a class="reference internal" href="#d-spectral-derivative" id="id15">3D Spectral Derivative</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="setup-and-grid-layout">
<h2><a class="toc-backref" href="#id4">Setup and Grid Layout</a><a class="headerlink" href="#setup-and-grid-layout" title="Permalink to this headline">¶</a></h2>
<p>In Fortran the grid structure is hidden and is operated on by integer handles.</p>
<div class="section" id="p3dfft-setup">
<h3><a class="toc-backref" href="#id5">p3dfft_setup</a><a class="headerlink" href="#p3dfft-setup" title="Permalink to this headline">¶</a></h3>
<p>subroutine p3dfft_setup</p>
<p>Function: called once in the beginning of use to initialize P3DFFT++.</p>
</div>
<div class="section" id="p3dfft-cleanup">
<h3><a class="toc-backref" href="#id6">p3dfft_cleanup</a><a class="headerlink" href="#p3dfft-cleanup" title="Permalink to this headline">¶</a></h3>
<p>subroutine p3dfft_cleanup</p>
<p>Function: called once before exit and after the use to free up P3DFFT++ structures.</p>
</div>
<div class="section" id="p3dfft-init-grid">
<h3><a class="toc-backref" href="#id7">p3dfft_init_grid</a><a class="headerlink" href="#p3dfft-init-grid" title="Permalink to this headline">¶</a></h3>
<p>function p3dfft_init_grid(ldims, glob_start, gdims, dim_conj_sym, pgrid, proc_order, mem_order, mpicomm)</p>
<p>integer(C_INT) p3dfft_init_grid</p>
<p>Function: initialize a new grid</p>
<p>Arguments:</p>
<p>IN:</p>
<p>integer gdims(3): three global grid dimensions (logical order - X, Y, Z)</p>
<p>integer dim_conj_sym: dimension of the array in which a little less than half of the elements are omitted due to conjugate symmetry. This argument should be non-negative only for complex-valued arrays resulting from real-to-complex FFT in the given dimension.</p>
<p>integer pgrid(3): up to three dimensions of processor grid, decomposing the global grid array. Value =1 means the grid is not decomposed but is local in that logical dimension.</p>
<p>integer proc_order(3): a permutation of the 3 integers: 0, 1 and 2. Specifies the topology of processor grid on the interconnect. The dimension with lower value means the MPI tasks in that dimension are closer in ranks, e.g. value=0 means the ranks are adjacent (stride=1), value=1 means they are speard out with the stride equal to the pgrid value of the dimension with stride=1 etc</p>
<p>integer mem_order(3): a permutation of the 3 integers: 0, 1 and 2. Specifies mapping of the logical dimension and memory storage dimensions for local memory for each MPI task. mem_order(i0) = 0 means that the i0’s logical dimension is stored with stride=1 in memory. Similarly, mem_order(i1) =1 means that i1’s logical dimension is stored with stride=ldims(i0) etc</p>
<p>integer mpicomm: the MPI communicator in which this grid lives</p>
<p>OUT:</p>
<p>integer ldims(3):local dimensions of the grid for each MPI tasks, in order of logical dimensions numbering (XYZ). Essentially ldims = gdims / pgrid.</p>
<p>integer glob_start(3): starting coordinates of the local portion of the grid within the global grid.</p>
<p>Return value: an integer handle of the initialized grid, to be used later by various routines accessing the grid.</p>
</div>
<div class="section" id="p3dfft-free-grid-f">
<h3><a class="toc-backref" href="#id8">p3dfft_free_grid_f</a><a class="headerlink" href="#p3dfft-free-grid-f" title="Permalink to this headline">¶</a></h3>
<p>subroutine p3dfft_free_grid_f(grid)</p>
<p>Function: frees the grid handle</p>
<p>Arguments:</p>
<p>IN: integer(C_INT) grid - the handle of the grid to be freed</p>
</div>
</div>
<div class="section" id="one-dimensional-1d-transforms">
<h2><a class="toc-backref" href="#id9">One-dimensional (1D) Transforms</a><a class="headerlink" href="#one-dimensional-1d-transforms" title="Permalink to this headline">¶</a></h2>
<p>The following predefined 1D transforms are available:</p>
<p>P3DFFT_EMPTY_TYPE - empty transform</p>
<p>P3DFFT_R2CFFT_S, P3DFFT_R2CFFT_D - real-to-complex forward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_C2RFFT_S, P3DFFT_C2RFFT_D - complex-to-real backward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_CFFT_FORWARD_S, P3DFFT_CFFT_FORWARD_D - complex forward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_CFFT_BACKWARD_S, P3DFFT_CFFT_BACKWARD_D - complex backward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_DCT&lt;x&gt;_REAL_S, P3DFFT_DCT1_REAL_D - cosine transform for real-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DCT1, DCT2, DCT3 or DCT4</p>
<p>P3DFFT_DST&lt;x&gt;_REAL_S, P3DFFT_DST1_REAL_D - sine transform for real-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DST1, DST2, DST3 or DST4</p>
<p>P3DFFT_DCT&lt;x&gt;_COMPLEX_S, P3DFFT_DCT1_COMPLEX_D - cosine transform for complex-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DCT1, DCT2, DCT3 or DCT4</p>
<p>P3 DFFT_DST&lt;x&gt;_COMPLEX_S, P3DFFT_DST1_COMPLEX_D - sine transform for complex-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DST1, DST2, DST3 or DST4</p>
<div class="section" id="d-transform-planning">
<h3><a class="toc-backref" href="#id10">1D transform planning</a><a class="headerlink" href="#d-transform-planning" title="Permalink to this headline">¶</a></h3>
<p>function p3dfft_plan_1Dtrans_f(gridIn, gridOut, type, dim, inplace)</p>
<p>integer p3dfft_plan_1Dtrans</p>
<p>Function: defines and plans a 1D transform of a 3D array in a given dimension</p>
<p>Arguments:</p>
<p>IN:</p>
<p>integer gridIn:initial grid handle</p>
<p>integer gridOut: destination grid handle</p>
<p>integer type: 1D transform type</p>
<p>integer dim:dimension rank of the 3D array which should be transformed. valid values are 0, 1 or 2. Note that this is the logical dimension rank (0 for X, 1 for Y, 2 for Z), and may not be the same as the storage dimension, which depends on mem_order member of gridIn and gridOut. The transform dimension of the grid is assumed to be MPI task-local.</p>
<p>integer inplace: nonzero value if the transform is in-place.</p>
</div>
<div class="section" id="d-transform-execution">
<h3><a class="toc-backref" href="#id11">1D transform execution</a><a class="headerlink" href="#d-transform-execution" title="Permalink to this headline">¶</a></h3>
<p>subroutine p3dfft_exec_1Dtrans_single(mytrans,in,out)</p>
<p>subroutine p3dfft_exec_1Dtrans_double(mytrans,in,out)</p>
<p>Function: Executes a 1D transform of a 3D array, in single or double precision</p>
<p>Arguments:</p>
<p>IN:</p>
<p>mytrans: the handle of a 1D transform predefined earlier with p3dfft_plan_1Dtrans.</p>
<p>in: 3D array to be transformed</p>
<p>out: destination array (can be the same if inplace was nonzero when defining mytrans)</p>
<p>Notes:</p>
<ol class="arabic simple">
<li>If inplace was not defined the input and output arrays must be non-overlapping.</li>
<li>This transform is done in the dimension specified in p3dfft_plan_1Dtrans, and this dimension should be local for both input and output arrays.</li>
<li>This subroutine can be called multiple times with the same mytrans and same or different in/out.</li>
</ol>
</div>
</div>
<div class="section" id="three-dimensional-transforms">
<h2><a class="toc-backref" href="#id12">Three-dimensional transforms</a><a class="headerlink" href="#three-dimensional-transforms" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id13">3D transform planning</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>function p3dfft_plan_3Dtrans_f(gridIn,gridOut,type,inplace, overwrite)</p>
<p>integer p3dfft_plan_3Dtrans_f</p>
<p>Function: defines and plans a 3D transform</p>
<p>Arguments:</p>
<p>integer gridIn: initial grid handle</p>
<p>integer gridOut: destination grid handle</p>
<p>integer type(3): three 1D transform types making up the desired 3D transform</p>
<p>integer inplace: if nonzero, the transform takes place in-place</p>
<p>integer overwrite: nonzero if the input can be overwritten</p>
<p>Return value: a handle of the 3D transform</p>
<p>Notes: The final grid may or may not be the same as the initial grid. First, in real-to-complex and complex-to-real transforms the global grid dimensions change for example from (n0,n1,n2) to (n0/2+1,n1,n2), since most applications attempt to save memory by using the conjugate symmetry of the Fourier transform of real data. Secondly, the final grid may have different processor distribution and memory ordering, since for example many applications with convolution and those solving partial differential equations do not need the initial grid configuration in Fourier space. The flow of these applications is typically 1) transform from physical to Fourier space, 2) apply convolution or derivative calculation in Fourier space, and 3) inverse FFT to physical space. Since forward FFT’s last step is 1D FFT in the third dimension, it is more efficient to leave this dimension local and stride-1, and since the first step of the inverse FFT is to start with the third dimension 1D FFT, this format naturally fits the algorithm and results in big savings of time due to elimination of several extra transposes.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id14">3D transform execution</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>subroutine p3dfft_exec_3Dtrans_single(mytrans,in,out)</p>
<p>subroutine p3dfft_exec_3Dtrans_double(mytrans,in,out)</p>
<p>Function: Executes a predefined 3D transform in single or double precision</p>
<p>Arguments:</p>
<p>mytrans: the handle of the predefined 3D transform</p>
<p>in: input array</p>
<p>out: output array</p>
<p>Notes: this subroutine can be called multiple times for the same mytrans and same or different in/out.Input and output arrays are local portions of the global 3D array, assumed to be stored contiguously in memory following the definition of the grids in planning stage.</p>
</div>
<div class="section" id="d-spectral-derivative">
<h3><a class="toc-backref" href="#id15">3D Spectral Derivative</a><a class="headerlink" href="#d-spectral-derivative" title="Permalink to this headline">¶</a></h3>
<p>p3dfft_exec_3Dtrans_single(mytrans, In, Out, idir)</p>
<p>p3dfft_exec_3Dtrans_double(mytrans, In, Out, idir)</p>
<p>Function: execute 3D real-to-complex FFT, followed by spectral derivative calculation, i.e. multiplication by (ik), where i is the complex imaginary unit, and k is the wavenumber; in single or double precision, respectively</p>
<p>Arguments:</p>
<p>In and Out are input and output arrays, assumed to be the local portion of the 3D grid array stored contiguously in memory, consistent with definition of Grid in planning stage.</p>
<p>integer idir is the dimension where derivative is to be taken in (this is logical dimension, NOT storage mapped). Valid values are 0 - 2.</p>
<p>Notes:</p>
<ol class="arabic simple">
<li>Unless inplace was defined in the planning stage of mytrans, In and Out must be non-overlapping</li>
<li>These functions can be used multiple times after the 3D transform has been defined and planned.</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="p3dfft++_c++_examples.html" title="P3DFFT++ C++ examples"
             >next</a> |</li>
        <li class="right" >
          <a href="p3dfft++_c_reference.html" title="P3DFFT++ C Reference"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">P3DFFT++ 3.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="p3dfft++_documentation.html" >P3DFFT++ Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Dmitry Pekurovsky.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>