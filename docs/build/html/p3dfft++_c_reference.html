

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>P3DFFT++ C Reference &#8212; P3DFFT++ 3.0.0 documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="P3DFFT++ Fortran Reference" href="p3dfft++_fortran_reference.html" />
    <link rel="prev" title="P3DFFT++ C++ Reference" href="p3dfft++_c++_reference.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="p3dfft++_fortran_reference.html" title="P3DFFT++ Fortran Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="p3dfft++_c++_reference.html" title="P3DFFT++ C++ Reference"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">P3DFFT++ 3.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="p3dfft++_documentation.html" accesskey="U">P3DFFT++ Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="p3dfft++_c++_reference.html"
                        title="previous chapter">P3DFFT++ C++ Reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="p3dfft++_fortran_reference.html"
                        title="next chapter">P3DFFT++ Fortran Reference</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="p3dfft-c-reference">
<h1><a class="toc-backref" href="#id3">P3DFFT++ C Reference</a><a class="headerlink" href="#p3dfft-c-reference" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#p3dfft-c-reference" id="id3">P3DFFT++ C Reference</a><ul>
<li><a class="reference internal" href="#setup-and-grid-layout" id="id4">Setup and Grid Layout</a><ul>
<li><a class="reference internal" href="#p3dfft-setup" id="id5">p3dfft_setup</a></li>
<li><a class="reference internal" href="#p3dfft-cleanup" id="id6">p3dfft_cleanup</a></li>
<li><a class="reference internal" href="#p3dfft-init-grid" id="id7">p3dfft_init_grid</a></li>
<li><a class="reference internal" href="#p3dfft-free-grid" id="id8">p3dfft_free_grid</a></li>
</ul>
</li>
<li><a class="reference internal" href="#one-dimensional-transforms" id="id9">One-dimensional transforms</a><ul>
<li><a class="reference internal" href="#d-transform-planning" id="id10">1D transform planning</a></li>
<li><a class="reference internal" href="#d-transform-execution" id="id11">1D transform execution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#three-dimensional-transforms" id="id12">Three-dimensional Transforms</a><ul>
<li><a class="reference internal" href="#p3dfft-init-3dtype" id="id13">p3dfft_init_3Dtype</a></li>
<li><a class="reference internal" href="#id1" id="id14">3D transform planning</a></li>
<li><a class="reference internal" href="#id2" id="id15">3D Transform Execution</a></li>
<li><a class="reference internal" href="#d-spectral-derivative" id="id16">3D Spectral Derivative</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="setup-and-grid-layout">
<h2><a class="toc-backref" href="#id4">Setup and Grid Layout</a><a class="headerlink" href="#setup-and-grid-layout" title="Permalink to this headline">¶</a></h2>
<div class="section" id="p3dfft-setup">
<h3><a class="toc-backref" href="#id5">p3dfft_setup</a><a class="headerlink" href="#p3dfft-setup" title="Permalink to this headline">¶</a></h3>
<p>void p3dfft_setup()</p>
<p>Function: called once in the beginning of use to initialize P3DFFT++.</p>
</div>
<div class="section" id="p3dfft-cleanup">
<h3><a class="toc-backref" href="#id6">p3dfft_cleanup</a><a class="headerlink" href="#p3dfft-cleanup" title="Permalink to this headline">¶</a></h3>
<p>void p3dfft_cleanup()</p>
<p>Function: called once before exit and after the use to free up P3DFFT++ structures.</p>
</div>
<div class="section" id="p3dfft-init-grid">
<h3><a class="toc-backref" href="#id7">p3dfft_init_grid</a><a class="headerlink" href="#p3dfft-init-grid" title="Permalink to this headline">¶</a></h3>
<p>Grid *p3dfft_init_grid(int gdims[3],int dim_conj_sym,int pgrid[3],int proc_order[3],int mem_order[3],MPI_Comm mpicomm);</p>
<p>Function: Initializes a new grid with specified parameters.</p>
<p>Arguments:</p>
<blockquote>
<div><p>gdims: three global grid dimensions (logical order - X, Y, Z)</p>
<p>dim_conj_sym: dimension of the array in which a little less than half of the elements are omitted due to conjugate symmetry. This argument should be non-negative only for complex-valued arrays resulting from real-to-complex FFT in the given dimension.</p>
<p>pgrid: up to three dimensions of processor grid, decomposing the global grid array. Value =1 means the grid is not decomposed but is local in that logical dimension.</p>
<p>proc_order: a permutation of the 3 integers: 0, 1 and 2. Specifies the topology of processor grid on the interconnect. The dimension with lower value means the MPI tasks in that dimension are closer in ranks, e.g. value=0 means the ranks are adjacent (stride=1), value=1 means they are speard out with the stride equal to the pgrid value of the dimension with stride=1 etc</p>
<p>mem_order: a permutation of the 3 integers: 0, 1 and 2. Specifies mapping of the logical dimension and memory storage dimensions for local memory for each MPI task. mem_order[i0] = 0 means that the i0’s logical dimension is stored with stride=1 in memory. Similarly, mem_order[i1] =1 means that i1’s logical dimension is stored with stride=ldims[i0] etc</p>
<p>mpicomm: the MPI communicator in which this grid lives</p>
</div></blockquote>
<p>Return value: a pointer to the newly initialized Grid structure that can later be used for grid operations and to get information about the grid.</p>
<p>The Grid structure is defined as follows:</p>
<p>struct Grid_struct {
int taskid,numtasks;
int nd; //number of dimensions the volume is split over
int gdims[3]; //Global dimensions</p>
<p>int dim_conj_sym; // Dimension of conjugate symmetry where we store N/2+1 of the data after Real-to-complex transform due to conjugate symmety;(-1 for none)</p>
<p>int mem_order[3]; //Memory ordering inside the data volume
int ldims[3]; //Local dimensions on THIS processor
int pgrid[3]; //Processor grid
int proc_order[3]; //Ordering of tasks in processor grid, e.g. (1,2,3) : first dimension - adjacent tasks,then second, then third dimension
int P[3]; //Processor grid size (in inverse order of split dimensions, i.e. rows first, then columns etc
int D[3]; //Ranks of Dimensions of physical grid split over rows and columns correspondingly
int L[3]; //Rank of Local dimension (p=1)
int grid_id[3]; //Position of this pencil/cube in the processor grid
int grid_id_cart[3];
int glob_start[3]; // Starting coords of this cube in the global grid
MPI_Comm mpi_comm_glob; // Global MPi communicator we are starting from
MPI_Comm mpi_comm_cart;
MPI_Comm mpicomm[3]; //MPI communicators for each dimension
} ;
typedef struct Grid_struct Grid;</p>
</div>
<div class="section" id="p3dfft-free-grid">
<h3><a class="toc-backref" href="#id8">p3dfft_free_grid</a><a class="headerlink" href="#p3dfft-free-grid" title="Permalink to this headline">¶</a></h3>
<p>void p3dfft_free_grid(Grid *gr)</p>
<p>Function: frees up grid.</p>
<p>Arguments:</p>
<blockquote>
<div>gr: pointer to Grid structure.</div></blockquote>
</div>
</div>
<div class="section" id="one-dimensional-transforms">
<h2><a class="toc-backref" href="#id9">One-dimensional transforms</a><a class="headerlink" href="#one-dimensional-transforms" title="Permalink to this headline">¶</a></h2>
<p>1D transforms can be done with or without data exchange and/or memory reordering. In general, combining a transform with an exchange/reordering can be beneficial for performance due to cache reuse, compared to two separate calls to a transform and an exchange.</p>
<p>The following predefined 1D transforms are available:</p>
<p>P3DFFT_EMPTY_TYPE - empty transform</p>
<p>P3DFFT_R2CFFT_S, P3DFFT_R2CFFT_D - real-to-complex forward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_C2RFFT_S, P3DFFT_C2RFFT_D - complex-to-real backward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_CFFT_FORWARD_S, P3DFFT_CFFT_FORWARD_D - complex forward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_CFFT_BACKWARD_S, P3DFFT_CFFT_BACKWARD_D - complex backward FFT (as defined in FFTW manual), in single and double precision respectively</p>
<p>P3DFFT_DCT&lt;x&gt;_REAL_S, P3DFFT_DCT1_REAL_D - cosine transform for real-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DCT1, DCT2, DCT3 or DCT4</p>
<p>P3DFFT_DST&lt;x&gt;_REAL_S, P3DFFT_DST1_REAL_D - sine transform for real-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DST1, DST2, DST3 or DST4</p>
<p>P3DFFT_DCT&lt;x&gt;_COMPLEX_S, P3DFFT_DCT1_COMPLEX_D - cosine transform for complex-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DCT1, DCT2, DCT3 or DCT4</p>
<p>P3 DFFT_DST&lt;x&gt;_COMPLEX_S, P3DFFT_DST1_COMPLEX_D - sine transform for complex-numbered data, in single and double precision, where &lt;x&gt; stands for the variant of the cosine transform, such as DST1, DST2, DST3 or DST4</p>
<div class="section" id="d-transform-planning">
<h3><a class="toc-backref" href="#id10">1D transform planning</a><a class="headerlink" href="#d-transform-planning" title="Permalink to this headline">¶</a></h3>
<p>int p3dfft_plan_1Dtrans(Grid *gridIn, Grid *gridOut, int type1D, int dim, int inplace)</p>
<p>Function: defines and plans a 1D transform of a 3D array. This planning stage must precede execution of 3D transform.</p>
<p>Arguments:</p>
<blockquote>
<div><p>gridIn and gridOut are pointers to the C equivalent of P3DFFT++ grid object (initial and final)</p>
<p>dim is the logical dimension of the transform (0, 1 or 2). Note that this is the logical dimension rank (0 for X, 1 for Y, 2 for Z), and may not be the same as the storage dimension, which depends on mem_order member of gridIn and gridOut. The transform dimension of the grid is assumed to be MPI task-local.</p>
<p>inplace indicates that this is not an in-place transform (a non-zero argument would indicate in-place).</p>
<p>Return value: The function returns a handle for the transform that can be used in other function calls.</p>
</div></blockquote>
<p>Notes:</p>
<p>This initialization/planning needs to be done once per transform type.</p>
</div>
<div class="section" id="d-transform-execution">
<h3><a class="toc-backref" href="#id11">1D transform execution</a><a class="headerlink" href="#d-transform-execution" title="Permalink to this headline">¶</a></h3>
<p>void p3dfft_exec_1Dtrans_double(int mytrans, double *IN, double *OUT)</p>
<p>void p3dfft_exec_1Dtrans_single(int mytrans, float *IN, float *OUT)</p>
<p>Function: executes double or single precision 1D transform, respectively, of a 3D array</p>
<p>Arguments:</p>
<blockquote>
<div><p>mytrans is the handle for the 1Dtransform</p>
<p>IN and OUT are pointers to one-dimensional input and output arrays containing the 3D grid stored contiguously in memory based on the local grid dimensions and storage order of gridIn and gridOut.</p>
</div></blockquote>
<p>Notes:</p>
<ol class="arabic simple">
<li>The execution can be performed many times with the same handle and same or different input and output arrays.</li>
<li>In case of out-of-place transform the input and output arrays must be non-overlapping.</li>
<li>Both input and output arrays must be local in the dimension of transform</li>
</ol>
</div>
</div>
<div class="section" id="three-dimensional-transforms">
<h2><a class="toc-backref" href="#id12">Three-dimensional Transforms</a><a class="headerlink" href="#three-dimensional-transforms" title="Permalink to this headline">¶</a></h2>
<div class="section" id="p3dfft-init-3dtype">
<h3><a class="toc-backref" href="#id13">p3dfft_init_3Dtype</a><a class="headerlink" href="#p3dfft-init-3dtype" title="Permalink to this headline">¶</a></h3>
<p>int p3dfft_init_3Dtype(int type_ids[3])</p>
<p>Function: Defines a 3D transform type</p>
<p>Arguments:</p>
<p>type_ids: an array of three 1D transform types.</p>
<p>Return value: a handle for 3D transform type.</p>
<p>Example:</p>
<p>int type_rcc, type_ids[3];</p>
<p>type_ids[0] = P3DFFT_R2CFFT_D;
type_ids[1] = P3DFFT_CFFT_FORWARD_D;
type_ids[2] = P3DFFT_CFFT_FORWARD_D;</p>
<p>type_rcc = p3dfft_init_3Dtype(type_ids);</p>
<p>In this example type_rcc will describe the real-to-complex (R2C) 3D transform (R2C in 1D followed by two complex 1D transforms).</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id14">3D transform planning</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>int p3dfft_plan_3Dtrans(Grid *gridIn, Grid *gridOut, int type3D, int inplace, int overwrite)</p>
<p>Function: plans a 3D transform. This planning stage must precede execution of 3D transform.</p>
<p>Arguments:</p>
<blockquote>
<div><p>gridIn and gridOut are pointers to initial and final grid objects</p>
<p>type3D is the 3D transform type defined as above</p>
<p>inplace is an integer indicating an in-place transform if it’s non-zero, out-of-place otherwise.</p>
<p>overwrite (optional) is non-zero when it is OK to overwrite the input array (optional argument, default is 0)</p>
</div></blockquote>
<p>Return value: The function returns an integer handle to the 3D transform that can be called multiple times by an execute function.</p>
<p>Notes:</p>
<ol class="arabic simple">
<li>This initialization/planning needs to be done once per transform type.</li>
<li>The final grid may or may not be the same as the initial grid. First, in real-to-complex and complex-to-real transforms the global grid dimensions change for example from (n0,n1,n2) to (n0/2+1,n1,n2), since most applications attempt to save memory by using the conjugate symmetry of the Fourier transform of real data. Secondly, the final grid may have different processor distribution and memory ordering, since for example many applications with convolution and those solving partial differential equations do not need the initial grid configuration in Fourier space. The flow of these applications is typically 1) transform from physical to Fourier space, 2) apply convolution or derivative calculation in Fourier space, and 3) inverse FFT to physical space. Since forward FFT’s last step is 1D FFT in the third dimension, it is more efficient to leave this dimension local and stride-1, and since the first step of the inverse FFT is to start with the third dimension 1D FFT, this format naturally fits the algorithm and results in big savings of time due to elimination of several extra transposes.</li>
</ol>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id15">3D Transform Execution</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>void p3dfft_exec_3Dtrans_single(int mytrans, float *In, float *Out)</p>
<p>void p3dfft_exec_3Dtrans_double(int mytrans, double *In, double *Out)</p>
<p>Function: execute 3D transform in single or double precision, respectively</p>
<p>Arguments:</p>
<blockquote>
<div>In and Out are pointers to input and output arrays, assumed to be the local portion of the 3D grid array,  stored contiguously in memory, consistent with definition of Grid in planning stage.</div></blockquote>
<p>Notes:</p>
<ol class="arabic simple">
<li>Unless inplace was defined in the planning stage of mytrans, In and Out must be non-overlapping</li>
<li>These functions can be used multiple times after the 3D transform has been defined and planned.</li>
</ol>
</div>
<div class="section" id="d-spectral-derivative">
<h3><a class="toc-backref" href="#id16">3D Spectral Derivative</a><a class="headerlink" href="#d-spectral-derivative" title="Permalink to this headline">¶</a></h3>
<p>void p3dfft_exec_3Dtrans_single(int mytrans, float *In, float *Out, int idir)</p>
<p>void p3dfft_exec_3Dtrans_double(int mytrans, double *In, double *Out, int idir)</p>
<p>Function: execute 3D real-to-complex FFT, followed by spectral derivative calculation, i.e. multiplication by (ik), where i is the complex imaginary unit, and k is the wavenumber; in single or double precision, respectively</p>
<p>Arguments:</p>
<p>In and Out are pointers to input and output arrays, assumed to be the local portion of the 3D grid array stored contiguously in memory, consistent with definition of Grid in planning stage.</p>
<p>idir is the dimension where derivative is to be taken in (this is logical dimension, NOT storage mapped). Valid values are 0 - 2.</p>
<p>Notes:</p>
<ol class="arabic simple">
<li>Unless inplace was defined in the planning stage of mytrans, In and Out must be non-overlapping</li>
<li>These functions can be used multiple times after the 3D transform has been defined and planned.</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="p3dfft++_fortran_reference.html" title="P3DFFT++ Fortran Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="p3dfft++_c++_reference.html" title="P3DFFT++ C++ Reference"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">P3DFFT++ 3.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="p3dfft++_documentation.html" >P3DFFT++ Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Dmitry Pekurovsky.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>